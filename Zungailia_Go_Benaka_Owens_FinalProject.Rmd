---
title: "ENV 710: Final Project"
author: "Isabel Zungailia, Li Jia Go, Isaac Benaka, Katie Owens"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
geometry: margin=2.54cm
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE)

#Packages

```

## Soil Moisture
```{r}
soil <- read.csv("soil.csv")
soil <- soil %>%
  #select(-row, -stake) %>%
  rename %>%
  mutate(soil = case_when(
    soil == "FF" ~ "Forest floor",
    soil == "MIN" ~ "Mineral soil",
    TRUE ~ soil)) %>%
  mutate(site = case_when(
    site == "P1" ~ "Plow 1",
    site == "P2" ~ "Plow 2",
    site == "S1" ~ "Pasture 1",
    site == "S2" ~ "Pasture 2",
    site == "W1" ~ "Woodlot 1",
    site == "W2" ~ "Woodlot 2",
    TRUE ~ site))

#Remove NAs
soil <- na.omit(soil)
#soil <- drop_na(soil$soil.moisture)
soil$stake <- as.factor(soil$stake)
soil$row <- as.factor(soil$row)
soil$site <- as.factor(soil$site)

#Visualize data
ggpairs(soil, c("site", "row", "stake", "soil", "soil.mass", "soil.moisture", "soil.moisture.capacity"))

#Count unique values for each variable
sapply(lapply(soil, unique), length)
  #soil variable only has one unique value (Forest floor) --> drop from model

#Create a FULL model --> soil moisture as dependent variable
smois1 <- lmer(soil.moisture ~ factor(site) + (1|row) + (1|stake) + ff.thickness + bulk.density + soil.mass + ph.h2o + ph.cacl2 + c + n + om + p + nh4 + no3 + n.min + nitr + cec + ca + mg + k + soil.moisture + soil.moisture.capacity, data = soil)
summary(smois1)
plot(smois1)

smois2 <- update(smois, .~. -bulk.density)
summary(smois2)

smois3 <- update(smois2, .~. -cec)
summary(smois3)

smois4 <- update(smois3, .~. -n.min)
summary(smois4)

smois5 <- update(smois4, .~. -nitr)
summary(smois5)

smois6 <- update(smois5, .~. -k)
summary(smois6)

smois7 <- update(smois6, .~. -c)
summary(smois7)

smois8 <- update(smois7, .~. -no3)
summary(smois8)

smois9 <- update(smois8, .~. -p)
summary(smois9)

smois10 <- update(smois9, .~. -om)
summary(smois10)

smois11 <- update(smois10, .~. -ph.cacl2)
summary(smois11)

smois12 <- update(smois11, .~. -ca)
summary(smois12)

smois13 <- update(smois12, .~. -mg)
summary(smois13)

smois14 <- update(smois13, .~. -nh4)
summary(smois14)

smois15 <- update(smois14, .~. -ph.h2o)
summary(smois15)

smois16 <- update(smois15, .~. -soil.mass)
summary(smois16)

smois17 <- update(smois16, .~. -n)
summary(smois17)

#Compare models with AIC
AIC(smois1, smois2, smois3, smois4, smois5, smois6, smois7, smois8, smois9, smois10, smois11, smois12, smois13, smois14, smois15, smois16, smois17)
  #smois17 is the best model

#Best Model
smois <- lmer(soil.moisture ~ factor(site) + (1|row) + (1|stake) + ff.thickness + soil.moisture.capacity, data = soil)
summary(smois)

## Check Assumptions

#Plot residuals
par(mfrow = c(2,2))
plot(smois)

#Check for heteroscedasticity
vif(smois)

MuMIn::r.squaredGLMM(smois) #final model has r-squared value of 0.594, meaning the model accounts for 59.4% of the variance in the response variable.

plot_model(smois)

#Diagnostics
check_model(smois, check = c("vif", "qq"))
check_model(smois, check = c("outliers"))
check_model(smois, check = c("reqq"))

#Site vs soil moisture (scatterplot)
ggplot(soil, aes(x=factor(site), y=soil.moisture)) +
  geom_point() +
  geom_smooth(se = FALSE, method = lm) +
  theme_bw() 

#Site vs soil moisture (boxplot)
ggplot(soil, aes(x=factor(site), y=soil.moisture)) +
  geom_boxplot() +
  geom_smooth(se = FALSE, method = lm) +
  theme_bw() + 
  labs(x="Site (Land Use Type)", y="Soil Moisture (gH20/gsoil)")

#Mean of soil moisture for each of the land use types
soil %>% filter(site == "Plow 1" | site == "Plow 2") %>%
  summarise(mean=mean(soil.moisture))
  #0.9737

soil %>% filter(site == "Pasture 1" | site == "Pasture 2") %>%
  summarise(mean=mean(soil.moisture))
  #1.238039	

soil %>% filter(site == "Woodlot 1" | site == "Woodlot 2") %>%
  summarise(mean=mean(soil.moisture))
  #1.604906	
```

```{r}
#Dataset for only Woodlot 1 and Woodlot 2
woodlot1 <- soil %>%
    filter(site %in% c("Woodlot 1"))

woodlot2 <- soil %>%
    filter(site %in% c("Plow 1"))

#Forest floor thickness vs soil moisture for Woodlot 1 & 2 

ggplot(woodlot1, aes(x=ff.thickness, y=soil.moisture)) +
  geom_point() +
  geom_smooth(se = FALSE, method = lm) +
  theme_bw() +ylab("Soil Moisture (gH20/gsoil)") + xlab("Woodlot 1 - Forest Floor Thickness (mm)")

ggplot(woodlot2, aes(x=ff.thickness, y=soil.moisture)) +
  geom_point() +
  geom_smooth(se = FALSE, method = lm) +
  theme_bw() +ylab("Soil Moisture") + xlab("Forest Floor Thickness (mm)")
```

```{r}
# Graph: Forest Floor Thickness X Soil Moisture
cfsmois <- fixef(smois)
with(soil, plot(ff.thickness, soil.moisture, pch=21, bg="white", main = "Relationship between Forest Floor Thickness and Soil Moisture by Colonial Land Use Type",
xlab = "Forest Floor Thickness (mm)",
ylab = "Soil Moisture (gH20/gsoil)", las = 1))
x <- seq(min(soil$ff.thickness), max(soil$ff.thickness), length=1000)

curve(cfsmois[1] + cfsmois[7]*x + cfsmois[8]*mean(soil$soil.moisture.capacity), add=T, col="orange", lwd = 1)  
# Pasture 1
curve(cfsmois[1] + cfsmois[2] + cfsmois[7]*x + cfsmois[8]*mean(soil$soil.moisture.capacity), add=T, col="purple", lwd = 1) 
# Pasture 2
curve(cfsmois[1] + cfsmois[3] + cfsmois[7]*x + cfsmois[8]*mean(soil$soil.moisture.capacity), add=T, col="green", lwd = 1) 
# Plow 1
curve(cfsmois[1] + cfsmois[4] + cfsmois[7]*x + cfsmois[8]*mean(soil$soil.moisture.capacity), add=T, col="blue", lwd = 1) 
# Plow 2
curve(cfsmois[1] + cfsmois[5] + cfsmois[7]*x + cfsmois[8]*mean(soil$soil.moisture.capacity), add=T, col="red", lwd = 1) 
# Woodlot 1
curve(cfsmois[1] + cfsmois[6] + cfsmois[7]*x + cfsmois[8]*mean(soil$soil.moisture.capacity), add=T, col="black", lwd = 1)
# Woodlot 2

LU <- c("Pasture 1", "Pasture 2", "Plow 1", "Plow 2", "Woodlot 1", "Woodlot 2")
Cols <- c("orange", "purple", "green", "blue", "red", "black")
legend("topleft", cex=0.75, LU, lty=1, col=Cols, lwd = 1)
```
















\pagebreak


***


## Appendix 

```{r ref.label=knitr::all_labels(), echo = T, eval = F}
``` 


-->